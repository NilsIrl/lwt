<html><head><title>Module Lwt_main </title><meta charset="utf8"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link rel="stylesheet" href="https://ocsigen.org/css/style.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/themes/prism.min.css"/><script type="text/javascript" src="https://ocsigen.org/js/client.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-core.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-ocaml.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-clike.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-reason.min.js">
//<![CDATA[

//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.9.0/components/prism-javascript.min.js">
//<![CDATA[

//]]>
</script></head><body class="Lwt_main lwt"><div class="project-page"><div class="page-header"><p class="logo-ocsigen"><a href=".././../../" class="ocsimore_phrasing_link"><img src=".././../../img/ocsigen-white.svg" alt="Ocsigen"/></a>
</p><p class="logo-subproject">Lwt</p><div class="mainmenu"><p class="mainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a></p><p class="mainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a></p><p><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a></p><p><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a></p><p class="mainmenu-current"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a></p><p><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a></p><p><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a></p></div><form id="googlesearch" action="https://google.com/search"><input name="q" id="gsearch-box" placeholder="Search using Google"/><label for="gsearch-box"><img src="/img/search.svg" alt="" id="gsearch-icon"/></label><input type="submit" id="gsearch-submit" onclick="document.getElementById('gsearch-box').value += ' site:ocsigen.org';"/></form><aside class="how-drawer"><input id="how-drawer-toggle" type="checkbox"/><label for="how-drawer-toggle" id="how-drawer-label"><span class="how-drawer-icon"></span></label><nav class="how-drawer-content"><ul class="drawermainmenu"><li class="drawermainmenu-home"><a href=".././../../" class="ocsimore_phrasing_link">Home</a>
</li><li class="drawermainmenu-doc"><a href=".././../../tuto/" class="ocsimore_phrasing_link">Doc</a>
</li><li class="drawermainmenu-project"><a href=".././../../eliom/" class="ocsimore_phrasing_link">Eliom</a>
</li><li class="drawermainmenu-project"><a href=".././../../js_of_ocaml/" class="ocsimore_phrasing_link">Js_of_ocaml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigenserver/" class="ocsimore_phrasing_link">Server</a>
</li><li class="drawermainmenu-project"><a href=".././../../lwt/" class="ocsimore_phrasing_link">Lwt</a>
</li><li class="drawermainmenu-project"><a href=".././../../tyxml/" class="ocsimore_phrasing_link">Tyxml</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-toolkit/" class="ocsimore_phrasing_link">Toolkit</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsigen-start/" class="ocsimore_phrasing_link">Start</a>
</li><li class="drawermainmenu-project"><a href=".././../../html_of_wiki/" class="ocsimore_phrasing_link">html_of_wiki</a>
</li><li class="drawermainmenu-project"><a href=".././../../deriving/" class="ocsimore_phrasing_link">deriving</a>
</li><li class="drawermainmenu-project"><a href=".././../../ocsimore/" class="ocsimore_phrasing_link">Ocsimore (<em>deprecated</em>)</a>
</li><li class="drawermainmenu-page"><a href=".././../../projects" class="ocsimore_phrasing_link">Other projects</a>
</li><li class="drawermainmenu-page"><a href=".././../../papers" class="ocsimore_phrasing_link">Research papers</a>
</li><li class="drawermainmenu-page"><a href=".././../../credits" class="ocsimore_phrasing_link">Who does Ocsigen?</a>
</li><li class="drawermainmenu-page"><a href=".././../../contributing" class="ocsimore_phrasing_link">Contributing</a>
</li><li class="drawermainmenu-page"><a href=".././../../blog" class="ocsimore_phrasing_link">Blog</a>
</li><li class="drawermainmenu-page"><a href=".././../../install" class="ocsimore_phrasing_link">Installation</a>
</li><li class="drawermainmenu-page"><a href="https://github.com/ocsigen" class="ocsimore_phrasing_link">Source code</a>
</li></ul><nav class="how-doctree"></nav></nav></aside></div><p class="reasonwarning">Warning: Reason support is experimental.
We are looking for beta-tester and contributors.
</p><button id="reason">Switch to </button><div class="twocols"><nav class="leftcol">Version <select class="how-versions" onchange="location = this.value;"><option value=".././../1.0.0/wiki/Lwt_main">1.0.0</option><option value=".././../1.1.0/wiki/Lwt_main">1.1.0</option><option value=".././../2.0.0/wiki/Lwt_main">2.0.0</option><option value=".././../2.1.0/wiki/Lwt_main">2.1.0</option><option value=".././../2.1.1/wiki/Lwt_main">2.1.1</option><option value=".././../2.2.0/wiki/Lwt_main">2.2.0</option><option value=".././../2.2.1/wiki/Lwt_main">2.2.1</option><option value=".././../2.3.0/wiki/Lwt_main">2.3.0</option><option value=".././../2.3.1/wiki/Lwt_main">2.3.1</option><option value=".././../2.3.2/wiki/Lwt_main">2.3.2</option><option value=".././../2.4.0/wiki/Lwt_main">2.4.0</option><option value=".././../2.4.1/wiki/Lwt_main">2.4.1</option><option value=".././../2.4.2/wiki/Lwt_main">2.4.2</option><option value=".././../2.4.3/wiki/Lwt_main">2.4.3</option><option value=".././../2.4.7/wiki/Lwt_main">2.4.7</option><option value=".././../2.4.8/wiki/Lwt_main">2.4.8</option><option value=".././../2.5.0/wiki/Lwt_main">2.5.0</option><option value=".././../2.5.1/wiki/Lwt_main">2.5.1</option><option value=".././../2.5.2/wiki/Lwt_main">2.5.2</option><option value=".././../2.6.0/wiki/Lwt_main">2.6.0</option><option value=".././../2.7.0/wiki/Lwt_main">2.7.0</option><option value=".././../2.7.1/wiki/Lwt_main">2.7.1</option><option value=".././../3.0.0/wiki/Lwt_main">3.0.0</option><option value=".././../3.1.0/wiki/Lwt_main">3.1.0</option><option value=".././../3.2.1/wiki/Lwt_main">3.2.1</option><option value=".././../3.3.0/wiki/Lwt_main">3.3.0</option><option value=".././../4.0.0/wiki/Lwt_main">4.0.0</option><option value=".././../4.0.1/wiki/Lwt_main">4.0.1</option><option value=".././../4.1.0/wiki/Lwt_main">4.1.0</option><option value=".././../4.2.0/wiki/Lwt_main">4.2.0</option><option value=".././../4.2.1/wiki/Lwt_main">4.2.1</option><option value=".././../4.3.0/wiki/Lwt_main">4.3.0</option><option value=".././../4.3.1/wiki/Lwt_main">4.3.1</option><option value=".././../4.4.0/wiki/Lwt_main">4.4.0</option><option value=".././../4.5.0/wiki/Lwt_main">4.5.0</option><option value=".././../5.0.0/wiki/Lwt_main">5.0.0</option><option value=".././../5.0.1/wiki/Lwt_main">5.0.1</option><option value=".././../5.1.0/wiki/Lwt_main">5.1.0</option><option value=".././../5.1.1/wiki/Lwt_main">5.1.1</option><option value=".././../5.1.2/wiki/Lwt_main">5.1.2</option><option value=".././../5.2.0/wiki/Lwt_main">5.2.0</option><option value=".././../5.3.0/wiki/Lwt_main">5.3.0</option><option value=".././../5.4.0/wiki/Lwt_main">5.4.0</option><option value=".././../5.4.1/wiki/Lwt_main">5.4.1</option><option value=".././../5.4.2/wiki/Lwt_main">5.4.2</option><option value=".././../5.5.0/wiki/Lwt_main" selected="selected">5.5.0</option><option value=".././../dev/wiki/Lwt_main">dev</option></select><nav class="how-doctree"></nav></nav><article class="rightcol"><h1>Module <span><a href=".././api/Lwt_main">Lwt_main</a></span> </h1><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span class="ocsforge_color_uid"><span class="ocsforge_color_uid">Lwt_main</span></span> <span class="ocsforge_color_delimiter">:</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Lwt_main">..</a></span><span class="ocsforge_color_keyword">end</span></pre><p>Main loop and event queue
</p><hr/><p>This module controls the ``main-loop'' of Lwt.
</p><pre class="ocsforge_color odocwiki_code" id="VALrun"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">run</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">'a <span><a href=".././api/Lwt#TYPEt">Lwt.t</a></span> <span class="ocsforge_color_delimiter">-&gt;</span> 'a</span></pre><div class="odocwiki_info"><p><span class="odocwiki_inlinecode">Lwt_main.run p</span> calls the Lwt scheduler, performing I/O until <span class="odocwiki_inlinecode">p</span>
resolves. <span class="odocwiki_inlinecode">Lwt_main.run p</span> returns the value in <span class="odocwiki_inlinecode">p</span> if <span class="odocwiki_inlinecode">p</span> is fulfilled.
If <span class="odocwiki_inlinecode">p</span> is rejected with an exception instead, <span class="odocwiki_inlinecode">Lwt_main.run p</span> raises that
exception.
</p><p>Every native and bytecode program that uses Lwt should call this function
at its top level. It implements the Lwt main loop.
</p><p>Example:

</p><pre class=""><code class="language-ocaml translatable">let main () = Lwt_io.write_line Lwt_io.stdout &quot;hello world&quot;

let () = Lwt_main.run (main ())</code></pre><p><span class="odocwiki_inlinecode">Lwt_main.run</span> is not available when targeting JavaScript, because the
environment (such as Node.js or the browser's script engine) implements
the I/O loop.
</p><p>On Unix, calling <span class="odocwiki_inlinecode">Lwt_main.run</span> installs a <span class="odocwiki_inlinecode">SIGCHLD</span> handler, which is
needed for the implementations of <span><a href=".././api/Lwt_unix#VALwaitpid">Lwt_unix.waitpid</a></span> and
<span><a href=".././api/Lwt_unix#VALwait4">Lwt_unix.wait4</a></span>. As a result, programs that call <span class="odocwiki_inlinecode">Lwt_main.run</span> and also
use non-Lwt system calls need to handle those system calls failing with
<span class="odocwiki_inlinecode">EINTR</span>.
</p><p>Nested calls to <span class="odocwiki_inlinecode">Lwt_main.run</span> are not allowed. That is, do not call
<span class="odocwiki_inlinecode">Lwt_main.run</span> in a callback triggered by a promise that is resolved by
an outer invocation of <span class="odocwiki_inlinecode">Lwt_main.run</span>. If your program makes such a call,
<span class="odocwiki_inlinecode">Lwt_main.run</span> will raise <span class="odocwiki_inlinecode">Failure</span>. This should be considered a logic
error (i.e., code making such a call is inherently broken).
</p><p>It is not safe to call <span class="odocwiki_inlinecode">Lwt_main.run</span> in a function registered with
<span class="odocwiki_inlinecode">Pervasives.at_exit</span>, use <span><a href=".././api/Lwt_main#VALat_exit">Lwt_main.at_exit</a></span> instead.</p></div><pre class="ocsforge_color odocwiki_code" id="VALyield"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">yield</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span><a href=".././api/Lwt#TYPEt">Lwt.t</a></span></span></pre><div class="odocwiki_info"><p><span class="odocwiki_inlinecode">yield ()</span> is a pending promise that is fulfilled after Lwt finishes
calling all currently ready callbacks, i.e. it is fulfilled on the next
“tick.”
</p><p><span class="odocwiki_inlinecode">yield</span> is now deprecated in favor of the more general <span><a href=".././api/Lwt#VALpause">Lwt.pause</a></span>
in order to avoid discrepancies in resolution (see below) and stay
compatible with other execution environments such as js_of_ocaml.
</p><p>Currently, paused promises are resolved more frequently than yielded promises.
The difference is unintended but existing applications could depend on it.
Unifying the two pools of promises into one in the future would eliminate
possible discrepancies and simplify the code.</p></div><pre class="ocsforge_color odocwiki_code" id="VALabandon_yielded_and_paused"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">abandon_yielded_and_paused</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type">unit <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p>Causes promises created with <span><a href=".././api/Lwt#VALpause">Lwt.pause</a></span> and <span><a href=".././api/Lwt_main#VALyield">Lwt_main.yield</a></span> to remain
forever pending.
</p><p><span class="odocwiki_inlinecode">yield</span> is now deprecated in favor of the more general <span><a href=".././api/Lwt#VALpause">Lwt.pause</a></span>.
Once <span class="odocwiki_inlinecode">yield</span> is phased out, this function will be deprecated as well.
</p><p>This is meant for use with <span class="odocwiki_inlinecode">Lwt.fork</span>, as a way to &quot;abandon&quot; more promise
chains that are pending in your process.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module type</span> <span><a href=".././api/Lwt_main.Hooks">Hooks</a></span> <span class="ocsforge_color_delimiter">=</span> <span class="ocsforge_color_keyword">sig</span><span><a href=".././api/Lwt_main.Hooks">..</a></span><span class="ocsforge_color_keyword">end</span></pre><div class="odocwiki_info"><p>Hook sequences.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Lwt_main.Enter_iter_hooks">Enter_iter_hooks</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Lwt_main.Hooks">Hooks</a></span></span><span class="odocwiki_type">with type 'return_value kind = 'return_value</span></pre><div class="odocwiki_info"><p>Hooks, of type <span class="odocwiki_inlinecode">unit -&gt; unit</span>, that are called before each iteration of the
Lwt main loop.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Lwt_main.Leave_iter_hooks">Leave_iter_hooks</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Lwt_main.Hooks">Hooks</a></span></span><span class="odocwiki_type">with type 'return_value kind = 'return_value</span></pre><div class="odocwiki_info"><p>Hooks, of type <span class="odocwiki_inlinecode">unit -&gt; unit</span>, that are called after each iteration of the
Lwt main loop.</p></div><pre class="ocsforge_color odocwiki_code"><span class="ocsforge_color_keyword">module</span> <span><a href=".././api/Lwt_main.Exit_hooks">Exit_hooks</a></span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span><a href=".././api/Lwt_main.Hooks">Hooks</a></span></span><span class="odocwiki_type">with type 'return_value kind = 'return_value Lwt.t</span></pre><div class="odocwiki_info"><p>Promise-returning hooks, of type <span class="odocwiki_inlinecode">unit -&gt; unit Lwt.t</span>, that are called at
process exit.</p></div><pre class="ocsforge_color odocwiki_code" id="VALenter_iter_hooks"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">enter_iter_hooks</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span><a href=".././api/Lwt_sequence#TYPEt">Lwt_sequence.t</a></span></span></pre><div class="odocwiki_info"><p><span class="odocwiki_warning">Deprecated.</span>Use module <span><a href=".././api/Lwt_main.Enter_iter_hooks">Lwt_main.Enter_iter_hooks</a></span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALleave_iter_hooks"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">leave_iter_hooks</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit<span class="ocsforge_color_delimiter">)</span> <span><a href=".././api/Lwt_sequence#TYPEt">Lwt_sequence.t</a></span></span></pre><div class="odocwiki_info"><p><span class="odocwiki_warning">Deprecated.</span>Use module <span><a href=".././api/Lwt_main.Leave_iter_hooks">Lwt_main.Leave_iter_hooks</a></span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALexit_hooks"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">exit_hooks</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span><a href=".././api/Lwt#TYPEt">Lwt.t</a></span><span class="ocsforge_color_delimiter">)</span> <span><a href=".././api/Lwt_sequence#TYPEt">Lwt_sequence.t</a></span></span></pre><div class="odocwiki_info"><p><span class="odocwiki_warning">Deprecated.</span>Use module <span><a href=".././api/Lwt_main.Exit_hooks">Lwt_main.Exit_hooks</a></span>.</p></div><pre class="ocsforge_color odocwiki_code" id="VALat_exit"><span class="ocsforge_color_keyword">val</span> <span class="odocwiki_name">at_exit</span> <span class="ocsforge_color_delimiter">:</span> <span class="odocwiki_type"><span class="ocsforge_color_delimiter">(</span>unit <span class="ocsforge_color_delimiter">-&gt;</span> unit <span><a href=".././api/Lwt#TYPEt">Lwt.t</a></span><span class="ocsforge_color_delimiter">)</span> <span class="ocsforge_color_delimiter">-&gt;</span> unit</span></pre><div class="odocwiki_info"><p><span class="odocwiki_inlinecode">Lwt_main.at_exit hook</span> is the same as
<span class="odocwiki_inlinecode">ignore (Lwt_main.Exit_hooks.add_first hook)</span>.</p></div></article></div></div></body></html>
